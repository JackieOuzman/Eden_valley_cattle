---
title: "Step 3 graphs and options"
author: "Jackie Ouzman"
date: "12 August 2019"
output: html_document
---

```{r setup and install load packages, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(tidyverse)
library(dplyr)
library(lubridate)
library(readxl)

library(ggplot2)
library(readr)
library(sp)
library(biogeo)
library(stringr)
library(rgdal)
library(sf)

library(gganimate)
library(png)
library(gifski)
#install.packages("transformr")
library(transformr)
library(DT)
```

#I need to view specfic days 
I have done this using the filter function and then check out the distance from fence.

Day 1 20/5/2019
Fence 1 and 2
Bring in the data from the data import and cleaning R markdown file
August work and recalulations was done on Pearcey so get the data from here.

```{r load in the bounadry data, echo=FALSE, message=FALSE, warning=FALSE}


#the boundary file and the VF files

eden_valley <- st_read(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/EdenValley_site1GDA_a.shp")
#assign a coord ref epsg
st_crs(eden_valley) <- 28354

#make this the epsg that will be used for all data
the_crs <- st_crs(eden_valley, asText = TRUE)


fence1 <- st_read(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/Fence1.shp")
fence2 <- st_read(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/Fence2.shp")
fence3 <- st_read(
 "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/Fence3.shp")
fence4 <- st_read(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/Fence4a.shp")
fence4_actual <- st_read(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/Fence4_actual.shp")
fence5 <- st_read(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/Fence5.shp")

st_crs(fence1) <- the_crs
st_crs(fence2) <- the_crs
st_crs(fence3) <- the_crs
st_crs(fence4) <- the_crs
st_crs(fence4_actual) <- the_crs
st_crs(fence5) <- the_crs


```
```{r load in the VF data, echo=FALSE, message=FALSE, warning=FALSE}

##################             VF1         ###################################################################
VF1_InclusionBord_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/sp_VF1_InclusionBord_animalID.csv")
#head(VF1_InclusionBord_animalID)
VF1_InclusionBord_animalID$date <- as_date(VF1_InclusionBord_animalID$date)
VF1_InclusionBord_animalID$time <- as_datetime(VF1_InclusionBord_animalID$time, tz="GMT")
VF1_InclusionBord_animalID <- mutate(VF1_InclusionBord_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
sp_VF1_InclusionBord_animalID <- st_as_sf(VF1_InclusionBord_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)
#check
#ggplot() +
#geom_sf(data = eden_valley, color = "black", fill = NA) +
#  geom_sf(data = st_geometry(sp_VF1_InclusionBord_animalID))
##################             VF2         ###################################################################
VF2_InclusionBord_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/sp_VF2_InclusionBord_animalID.csv")
#head(VF2_InclusionBord_animalID)

#assign WGS EPSG for coords for each of the VF dataframes
VF2_InclusionBord_animalID$date <- as_date(VF2_InclusionBord_animalID$date)
VF2_InclusionBord_animalID$time <- as_datetime(VF2_InclusionBord_animalID$time, tz="GMT")
VF2_InclusionBord_animalID <- mutate(VF2_InclusionBord_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign coords for each of the VF dataframes
sp_VF2_InclusionBord_animalID <- st_as_sf(VF2_InclusionBord_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)

##################             VF3         ###################################################################
VF3_InclusionBord_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/sp_VF3_InclusionBord_animalID.csv")
#head(VF3_InclusionBord_animalID)

#assign WGS EPSG for coords for each of the VF dataframes
VF3_InclusionBord_animalID$date <- as_date(VF3_InclusionBord_animalID$date)
VF3_InclusionBord_animalID$time <- as_datetime(VF3_InclusionBord_animalID$time, tz="GMT")
VF3_InclusionBord_animalID <- mutate(VF3_InclusionBord_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign coords for each of the VF dataframes
sp_VF3_InclusionBord_animalID <- st_as_sf(VF3_InclusionBord_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)

##################             VF4         ###################################################################
VF4_InclusionBord_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/sp_VF4_InclusionBord_animalID.csv")
#head(VF4_InclusionBord_animalID)

#assign WGS EPSG for coords for each of the VF dataframes
VF4_InclusionBord_animalID$date <- as_date(VF4_InclusionBord_animalID$date)
VF4_InclusionBord_animalID$time <- as_datetime(VF4_InclusionBord_animalID$time, tz="GMT")
VF4_InclusionBord_animalID <- mutate(VF4_InclusionBord_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign coords for each of the VF dataframes
sp_VF4_InclusionBord_animalID <- st_as_sf(VF4_InclusionBord_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)
```

```{r load in the cue data, echo=FALSE, message=FALSE, warning=FALSE}

##################             Cue Vf1         ###################################################################
VF1_cue_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF_1_Audio_Pulse.csv")
#head(VF1_cue_animalID)
VF1_cue_animalID$date <- as_date(VF1_cue_animalID$date)
VF1_cue_animalID$time <- as_datetime(VF1_cue_animalID$time, tz="GMT")
VF1_cue_animalID <- mutate(VF1_cue_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
VF1_cue_animalID <- st_as_sf(VF1_cue_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)
#check
#ggplot() +
#geom_sf(data = eden_valley, color = "black", fill = NA) +
#  geom_sf(data = st_geometry(VF1_cue_animalID))
##################             Cue Vf2         ###################################################################
VF2_cue_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF_2_Audio_Pulse.csv")
#head(VF2_cue_animalID)
VF2_cue_animalID$date <- as_date(VF2_cue_animalID$date)
VF2_cue_animalID$time <- as_datetime(VF2_cue_animalID$time, tz="GMT")
VF2_cue_animalID <- mutate(VF2_cue_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
VF2_cue_animalID <- st_as_sf(VF2_cue_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)
##################             Cue Vf3         ###################################################################
VF3_cue_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF_3_Audio_Pulse.csv")
#head(VF3_cue_animalID)
VF3_cue_animalID$date <- as_date(VF3_cue_animalID$date)
VF3_cue_animalID$time <- as_datetime(VF3_cue_animalID$time, tz="GMT")
VF3_cue_animalID <- mutate(VF3_cue_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
VF3_cue_animalID <- st_as_sf(VF3_cue_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)
##################             Cue Vf4         ###################################################################
VF4_cue_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF_4_Audio_Pulse.csv")
#head(VF4_cue_animalID)
VF4_cue_animalID$date <- as_date(VF4_cue_animalID$date)
VF4_cue_animalID$time <- as_datetime(VF4_cue_animalID$time, tz="GMT")
VF4_cue_animalID <- mutate(VF4_cue_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
VF4_cue_animalID <- st_as_sf(VF4_cue_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)

##################             Cue Vf4_buff         ###################################################################
VF4buff_cue_animalID <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF_4_Audio_Pulse_buff.csv")
#head(VF4_cue_animalID)
VF4buff_cue_animalID$date <- as_date(VF4buff_cue_animalID$date)
VF4buff_cue_animalID$time <- as_datetime(VF4buff_cue_animalID$time, tz="GMT")
VF4buff_cue_animalID <- mutate(VF4buff_cue_animalID,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
VF4buff_cue_animalID <- st_as_sf(VF4buff_cue_animalID, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)
#merge the cue data Vf1-4

VF1_2_3_4_cue_animalID <- rbind(VF1_cue_animalID,
                                VF2_cue_animalID,
                                VF3_cue_animalID,
                                VF4_cue_animalID)

VF1_2_3_4buff_cue_animalID <- rbind(VF1_cue_animalID,
                                VF2_cue_animalID,
                                VF3_cue_animalID,
                                VF4buff_cue_animalID)
```


Fence 1 on the 20/5/2019

```{r inspect data to view quaility day1}


sp_VF1_InclusionBord_animalID_20 <- sp_VF1_InclusionBord_animalID %>% 
  filter(date == "2019-05-20") 
  

Inclusion_Dist20_05 <-  ggplot(sp_VF1_InclusionBord_animalID_20, aes(x = hms, y = distance_VF, colour = collar))+
  geom_point()+
  facet_wrap(.~animal_ID)+
  geom_hline(yintercept = 0)+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.position = "none")+
  labs(title= "Week1 2019-05-20",
       x= "Time of day",
       y = "Distance (m) from VF")
Inclusion_Dist20_05
#ggsave(filename = "Inclusion_Dist20_05.png", device = "png" )

x_yInclusion_Dist20_05 <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence1, color = "grey") +
  geom_sf(data = sp_VF1_InclusionBord_animalID_20, aes(colour = animal_ID))+
  facet_wrap(.~animal_ID)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-20")+
  xlab("") +
  ylab("") 

x_yInclusion_Dist20_05

ggsave(filename = "x_yInclusion_Dist20_05_Vf1.png", device = "png" ,dpi=600)

ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence1, color = "blue") +
  geom_sf(data = sp_VF1_InclusionBord_animalID_20, alpha = 0.01)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-20")+
  xlab("") +
  ylab("") 



```


Fence 2 20th
```{r inspect data to view quaility day2, echo=FALSE, message=FALSE, warning=FALSE}
sp_VF2_InclusionBord_animalID_20 <- sp_VF2_InclusionBord_animalID %>% 
  filter(date == "2019-05-20") 
  

Inclusion_Dist20_05vf2 <-  ggplot(sp_VF2_InclusionBord_animalID_20, aes(x = hms, y = distance_VF, colour = collar))+
  geom_point()+
  facet_wrap(.~animal_ID)+
  geom_hline(yintercept = 0)+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.position = "none")+
  labs(title= "Week1 2019-05-20",
       x= "Time of day",
       y = "Distance (m) from VF")
Inclusion_Dist20_05vf2
ggsave(filename = "Inclusion_Dist20_05_vf2.png", device = "png" )

x_yInclusion_Dist20_05_vf2 <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence1, color = "grey") +
  geom_sf(data = sp_VF2_InclusionBord_animalID_20, aes(colour = animal_ID))+
  facet_wrap(.~animal_ID)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-20")+
  xlab("") +
  ylab("") 

x_yInclusion_Dist20_05_vf2

ggsave(filename = "x_yInclusion_Dist20_05_Vf2.png", device = "png" ,dpi=600)

ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence2, color = "blue") +
  geom_sf(data = sp_VF2_InclusionBord_animalID_20, alpha = 0.01)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-20")+
  xlab("") +
  ylab("") 

```

Fence 2 21th

```{r inspect data to view quaility VF2 day2, echo=FALSE, message=FALSE, warning=FALSE}
sp_VF2_InclusionBord_animalID_21 <- sp_VF2_InclusionBord_animalID %>% 
  filter(date == "2019-05-21") 
  

Inclusion_Dist21_05vf2 <-  ggplot(sp_VF2_InclusionBord_animalID_21, aes(x = hms, y = distance_VF, colour = collar))+
  geom_point()+
  facet_wrap(.~animal_ID)+
  geom_hline(yintercept = 0)+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.position = "none")+
  labs(title= "Week1 2019-05-20",
       x= "Time of day",
       y = "Distance (m) from VF")
Inclusion_Dist21_05vf2
ggsave(filename = "Inclusion_Dist21_05vf2.png", device = "png" )

x_yInclusion_Dist21_05_vf2 <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence1, color = "grey") +
  geom_sf(data = sp_VF2_InclusionBord_animalID_21, aes(colour = animal_ID))+
  facet_wrap(.~animal_ID)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-21")+
  xlab("") +
  ylab("") 

x_yInclusion_Dist21_05_vf2

ggsave(filename = "x_yInclusion_Dist21_05_Vf2.png", device = "png" ,dpi=600)

ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence2, color = "blue") +
  geom_sf(data = sp_VF2_InclusionBord_animalID_21, alpha = 0.01)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-21")+
  xlab("") +
  ylab("") 

```

Animation giff day 1 

```{r animation for day 1}

#having trouble getting this going - could try the df not spatial object data??
#getting close
p4a <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence1, color = "grey") +
  geom_sf(data = sp_VF1_InclusionBord_animalID_20, aes(colour = animal_ID))+
  #geom_point(data = Inclusion_20_05_2019, aes(POINT_X, POINT_Y,colour = collar), inherit.aes = FALSE) +
  #facet_wrap(.~collar)+
  theme_bw()+
  theme(legend.position = "none",
        axis.text.x=element_blank(),
        axis.text.y=element_blank())
p4a  

p4b <- p4a +
  labs( title =   'Date:  {format(as_datetime(frame_time ), tz="GMT")}',
        #title =   'Date:  {format(as_datetime(frame_time, "%b %e"), tz="GMT")}',
        #subtitle = 'Hour: {format(as_datetime(frame_time, "%H"), tz="GMT")}',
        caption = "Frame {frame} of {nframes} ({progress * 100}%)") +
  transition_time(time) +
  shadow_wake(0.3)

animation_20thVf1 <- animate(p4b, duration = 60) 
animation_20thVf1

anim_save(animation = animation_20thVf1 , filename = "animation_20thVf1.gif")

# help with some errors - https://github.com/thomasp85/transformr
```

Animation giff day 1 VF 2


```{r animation for day 1 vf 2}
p4a <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence2, color = "grey") +
  geom_sf(data = sp_VF2_InclusionBord_animalID_20, aes(colour = animal_ID))+
  theme_bw()+
  theme(legend.position = "none",
        axis.text.x=element_blank(),
        axis.text.y=element_blank())
p4a  

p4b <- p4a +
  labs( title =   'Date:  {format(as_datetime(frame_time), tz="GMT")}',
        #subtitle = 'Hour: {format(as_datetime(frame_time, "%H"), tz="GMT")}',
        caption = "Frame {frame} of {nframes} ({progress * 100}%)") +
  transition_time(time) +
  shadow_wake(0.3)

animation_20thVf2 <- animate(p4b, duration = 60) 
animation_20thVf2

anim_save(animation = animation_20thVf2 , filename = "animation_20thVf2.gif")
```

Animation giff day 2 VF 2

```{r animation for day 2 vf 2}
p4a <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence2, color = "grey") +
  geom_sf(data = sp_VF2_InclusionBord_animalID_21, aes(colour = animal_ID))+
  theme_bw()+
  theme(legend.position = "none",
        axis.text.x=element_blank(),
        axis.text.y=element_blank())
p4a  

p4b <- p4a +
  labs( title =   'Date:  {format(as_datetime(frame_time), tz="GMT")}',
        #subtitle = 'Hour: {format(as_datetime(frame_time, "%H"), tz="GMT")}',
        caption = "Frame {frame} of {nframes} ({progress * 100}%)") +
  transition_time(time) +
  shadow_wake(0.3)

animation_21thVf2 <- animate(p4b, duration = 60) 
animation_21thVf2

anim_save(animation = animation_21thVf2 , filename = "animation_21thVf2.gif")
```



Other days Vf 3 23rd

```{r inspect data to view quaility VF3 23/5/2019, echo=FALSE, message=FALSE, warning=FALSE}
sp_VF3_InclusionBord_animalID_23 <- sp_VF3_InclusionBord_animalID %>% 
  filter(date == "2019-05-23") 
  

Inclusion_Dist23_05vf3 <-  ggplot(sp_VF3_InclusionBord_animalID_23, aes(x = hms, y = distance_VF, colour = collar))+
  geom_point()+
  facet_wrap(.~animal_ID)+
  geom_hline(yintercept = 0)+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.position = "none")+
  labs(title= "Week1 2019-05-23",
       x= "Time of day",
       y = "Distance (m) from VF")
Inclusion_Dist23_05vf3
#ggsave(filename = "Inclusion_Dist23_05vf3.png", device = "png" )

x_yInclusion_Dist23_05vf3 <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence3, color = "grey") +
  geom_sf(data = sp_VF3_InclusionBord_animalID_23, aes(colour = animal_ID))+
  facet_wrap(.~animal_ID)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-23")+
  xlab("") +
  ylab("") 

x_yInclusion_Dist23_05vf3

ggsave(filename = "x_yInclusion_Dist23_05_Vf3.png", device = "png" ,dpi=600)

ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence3, color = "blue") +
  geom_sf(data = sp_VF3_InclusionBord_animalID_23, alpha = 0.01)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-23")+
  xlab("") +
  ylab("") 

```



Other days Vf 3 24rd

```{r inspect data to view quaility VF3 24/5/2019, echo=FALSE, message=FALSE, warning=FALSE}
sp_VF3_InclusionBord_animalID_24 <- sp_VF3_InclusionBord_animalID %>% 
  filter(date == "2019-05-24") 
  

Inclusion_Dist24_05vf3 <-  ggplot(sp_VF3_InclusionBord_animalID_24, aes(x = hms, y = distance_VF, colour = collar))+
  geom_point()+
  facet_wrap(.~animal_ID)+
  geom_hline(yintercept = 0)+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.position = "none")+
  labs(title= "Week1 2019-05-24",
       x= "Time of day",
       y = "Distance (m) from VF")
Inclusion_Dist24_05vf3
#ggsave(filename = "Inclusion_Dist24_05vf3.png", device = "png" )

x_yInclusion_Dist24_05vf3 <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence3, color = "grey") +
  geom_sf(data = sp_VF3_InclusionBord_animalID_24, aes(colour = animal_ID))+
  facet_wrap(.~animal_ID)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-24")+
  xlab("") +
  ylab("") 

x_yInclusion_Dist24_05vf3

ggsave(filename = "x_yInclusion_Dist24_05_Vf3.png", device = "png" ,dpi=600)

ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence3, color = "blue") +
  geom_sf(data = sp_VF3_InclusionBord_animalID_24, alpha = 0.01)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-24")+
  xlab("") +
  ylab("") 

```





Other days Vf 4 28th

```{r inspect data to view quaility VF4 28/5/2019, echo=FALSE, message=FALSE, warning=FALSE}
sp_VF4_InclusionBord_animalID_28 <- sp_VF4_InclusionBord_animalID %>% 
  filter(date == "2019-05-28") 
  

Inclusion_Dist28_05vf4 <-  ggplot(sp_VF4_InclusionBord_animalID_28, aes(x = hms, y = distance_VF, colour = collar))+
  geom_point()+
  facet_wrap(.~animal_ID)+
  geom_hline(yintercept = 0)+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.position = "none")+
  labs(title= "Week1 2019-05-28",
       x= "Time of day",
       y = "Distance (m) from VF")
Inclusion_Dist28_05vf4
#ggsave(filename = "Inclusion_Dist28_05vf4.png", device = "png" )

x_yInclusion_Dist28_05vf4 <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence4, color = "grey") +
  geom_sf(data = sp_VF4_InclusionBord_animalID_28, aes(colour = animal_ID))+
  facet_wrap(.~animal_ID)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-28")+
  xlab("") +
  ylab("") 

x_yInclusion_Dist28_05vf4

ggsave(filename = "x_yInclusion_Dist28_05_Vf4.png", device = "png" ,dpi=600)

ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence4, color = "blue") +
  geom_sf(data = sp_VF4_InclusionBord_animalID_28, alpha = 0.01)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-28")+
  xlab("") +
  ylab("") 

```


Other days Vf 4 29th

```{r inspect data to view quaility VF4 29/5/2019, echo=FALSE, message=FALSE, warning=FALSE}
sp_VF4_InclusionBord_animalID_29 <- sp_VF4_InclusionBord_animalID %>% 
  filter(date == "2019-05-29") 
  

Inclusion_Dist29_05vf4 <-  ggplot(sp_VF4_InclusionBord_animalID_29, aes(x = hms, y = distance_VF, colour = collar))+
  geom_point()+
  facet_wrap(.~animal_ID)+
  geom_hline(yintercept = 0)+
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.position = "none")+
  labs(title= "Week1 2019-05-29",
       x= "Time of day",
       y = "Distance (m) from VF")
Inclusion_Dist29_05vf4
#ggsave(filename = "Inclusion_Dist29_05vf4.png", device = "png" )

x_yInclusion_Dist29_05vf4 <- ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence4, color = "grey") +
  geom_sf(data = sp_VF4_InclusionBord_animalID_29, aes(colour = animal_ID))+
  facet_wrap(.~animal_ID)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-29")+
  xlab("") +
  ylab("") 

x_yInclusion_Dist29_05vf4

ggsave(filename = "x_yInclusion_Dist29_05_Vf4.png", device = "png" ,dpi=600)

ggplot() +
  geom_sf(data = eden_valley, color = "black", fill = NA) +
  geom_sf(data = fence4, color = "blue") +
  geom_sf(data = sp_VF4_InclusionBord_animalID_29, alpha = 0.01)+
  theme_bw()+
  theme(legend.position = "none",
        axis.ticks = element_blank(), axis.text.x = element_blank(), axis.text.y = element_blank())+
  labs(title= "2019-05-29")+
  xlab("") +
  ylab("") 

```

#plot of audio and pulse data
Plot the aduio data for VF 1 day 1.
Just checking out options.

```{r plot the audio data VF 1 datw 20th}
table(VF1_cue_animalID$event)


with(VF1_cue_animalID, table(event, animal_ID))
with(VF1_cue_animalID, table(event, date))

VF1_cue_animalID <- mutate(VF1_cue_animalID,
                                   audio_pulse_started = case_when(
                                     event == "Audio started" ~ "Audio",
                                     event == "Audio started (short)" ~ "Audio",
                                     event == "Pulse started" ~ "Pulse"))

Aduio_pulse_sum1_per_animal_day <- group_by(VF1_cue_animalID, date, animal_ID, audio_pulse_started) %>% 
  summarise(count = n())

##as bar per animal per day
ggplot(Aduio_pulse_sum1_per_animal_day, aes(x = audio_pulse_started, y = count))+
  geom_col()+
  facet_wrap(.~ animal_ID)+
  theme_bw()+
  geom_text(aes(label = count), vjust = -1.0, hjust = 0.5)+
    theme_classic()+
    labs(x= "Type of cue",
         y = "counts",
         title = "Counts of cues per day per animal",
         subtitle = "VF 1 Day 1",
         caption = "VF 1 day 1 20/5/2019, per animal per day. Started data only")+
    theme(axis.text.x=element_text(angle=45,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous( limits=c(0, 30))
ggsave(filename = "Aduio_pulse_sum1_per_animal_dayvf1Day20.png", device = "png" ,dpi=600)

##as bar per day
Aduio_pulse_sum1_per_day <- group_by(VF1_cue_animalID, date, audio_pulse_started) %>% 
  summarise(count = n())

ggplot(Aduio_pulse_sum1_per_day, aes(x = audio_pulse_started, y = count))+
  geom_col()+
  theme_bw()+
  geom_text(aes(label = count), vjust = -1.0, hjust = 0.5)+
    theme_classic()+
    labs(x= "Type of cue",
         y = "counts",
         title = "Counts of cues per day",
         subtitle = "VF 1 Day 1",
         caption = "VF 1 day 1 20/5/2019, per day. Started data only")+
    theme(axis.text.x=element_text(angle=45,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous( limits=c(0, 120))
ggsave(filename = "Aduio_pulse_sum1_per_dayvf1Day20.png", device = "png" ,dpi=600)
```


What about merging the cue data together?

```{r plot the audio and pulse data merge data per animal per day}
table(VF1_2_3_4buff_cue_animalID$event)


with(VF1_2_3_4buff_cue_animalID, table(event, animal_ID))
with(VF1_2_3_4buff_cue_animalID, table(event, date))

VF1_2_3_4buff_cue_animalID <- mutate(VF1_2_3_4buff_cue_animalID,
                                   audio_pulse_started = case_when(
                                     event == "Audio started" ~ "Audio",
                                     event == "Audio started (short)" ~ "Audio",
                                     event == "Pulse started" ~ "Pulse"))
#explore the data per animal per day in a table

VF1_2_3_4buff_cue_animalID_per_animal_per_day <- group_by(VF1_2_3_4buff_cue_animalID, date, animal_ID, audio_pulse_started) %>% 
  summarise(count = n()) 

VF1_2_3_4buff_cue_animalID_per_animal_per_day <-st_set_geometry(VF1_2_3_4buff_cue_animalID_per_animal_per_day, NULL)
      
#put it in a data table                            
datatable(VF1_2_3_4buff_cue_animalID_per_animal_per_day)

#as a dots for animals per day with VF buffer data
VF_dates=data.frame(date=as.Date(c("2019-05-20", "2019-05-23", "2019-05-28", "2019-06-03")), 
             event=c("VF1&2", "VF3", "VF4", "VF5"))
head(VF1_2_3_4buff_cue_animalID_per_animal_per_day)
###as dots with VF buffer data
filter(VF1_2_3_4buff_cue_animalID_per_animal_per_day, audio_pulse_started != "NA") %>% 
ggplot( aes(x = date, y = count, colour = audio_pulse_started))+
  geom_point()+
  theme_bw()+
  facet_wrap(. ~ animal_ID)+
  geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.title=element_blank())+
  labs(title= "Week1 to 3",
       x= "Date",
       y = "Counts of cues",
       caption = "VF 4 buffer data used")
        

###as dots with VF no buffer data
filter(VF1_2_3_4_cue_animalID_per_animal_per_day, audio_pulse_started != "NA") %>% 
ggplot( aes(x = date, y = count, colour = audio_pulse_started))+
  geom_point()+
  theme_bw()+
  facet_wrap(. ~ animal_ID)+
  geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.title=element_blank())+
  labs(title= "Week1 to 3",
       x= "Date",
       y = "Counts of cues",
       caption = "VF 4 non buffer data used")

#can I change the date to a factor and then create a box plot yes!
VF1_2_3_4buff_cue_animalID_per_animal_per_day$date_factor <- factor(VF1_2_3_4buff_cue_animalID_per_animal_per_day$date)
#table(VF1_2_3_4_cue_animalID_per_animal_per_day$date_factor)




```

```{r suss out the VF4 buffer cue data}
###VF non buff
VF4_cue_animalID <- mutate(VF4_cue_animalID,
                                   audio_pulse_started = case_when(
                                     event == "Audio started" ~ "Audio",
                                     event == "Audio started (short)" ~ "Audio",
                                     event == "Pulse started" ~ "Pulse"))
#explore the data per animal per day in a table
VF4_cue_animalID_per_animal_per_day <- group_by(VF4_cue_animalID, date, animal_ID, audio_pulse_started) %>% 
  summarise(count = n()) 

#plot non buff
filter(VF4_cue_animalID_per_animal_per_day, audio_pulse_started != "NA") %>% 
ggplot( aes(x = date, y = count, colour = audio_pulse_started))+
  geom_point()+
  theme_bw()+
  facet_wrap(. ~ animal_ID)+
  geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.title=element_blank())+
  labs(title= "Vf 4 only",
       x= "Date",
       y = "Counts of cues",
       caption = "VF 4 non buffer data used")


###VF  buff
VF4buff_cue_animalID <- mutate(VF4buff_cue_animalID,
                                   audio_pulse_started = case_when(
                                     event == "Audio started" ~ "Audio",
                                     event == "Audio started (short)" ~ "Audio",
                                     event == "Pulse started" ~ "Pulse"))
#explore the data per animal per day in a table
VF4buff_cue_animalID_per_animal_per_day <- group_by(VF4buff_cue_animalID, date, animal_ID, audio_pulse_started) %>% 
  summarise(count = n()) 

#plot buff
filter(VF4buff_cue_animalID_per_animal_per_day, audio_pulse_started != "NA") %>% 
ggplot( aes(x = date, y = count, colour = audio_pulse_started))+
  geom_point()+
  theme_bw()+
  facet_wrap(. ~ animal_ID)+
  geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1),
        legend.title=element_blank())+
  labs(title= "Week1 to 3",
       x= "Date",
       y = "Counts of cues",
       caption = "VF 4 buffer data used")


```




```{r plot the audio data merge data per animal per day other options}

head(VF1_2_3_4buff_cue_animalID)

VF1_2_3_4buff_cue_animalID_by_cue_animal_date <- group_by(VF1_2_3_4buff_cue_animalID, date, animal_ID, audio_pulse_started) %>% 
    summarise(count = n()) 
head(VF1_2_3_4buff_cue_animalID_by_cue_animal_date)

#can I change the date to a factor and then create a box plot?
VF1_2_3_4buff_cue_animalID_by_cue_animal_date$date_factor <- factor(VF1_2_3_4buff_cue_animalID_by_cue_animal_date$date)

VF1_2_3_4buff_cue_animalID_by_cue_animal_date_aduio <- filter(VF1_2_3_4buff_cue_animalID_by_cue_animal_date, audio_pulse_started == "Audio") 

with(VF1_2_3_4buff_cue_animalID_by_cue_animal_date_aduio, table(date_factor, animal_ID))

### Audio 

  ggplot(VF1_2_3_4buff_cue_animalID_by_cue_animal_date_aduio, aes(x = date_factor, y = count))+
  geom_boxplot(alpha = 0.2)+
  geom_point()+
  theme_bw()+
  #facet_wrap(. ~ animal_ID)+
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.5) +
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  labs(title= "",
       x= "Date",
       y = "Counts of aduio cues",
       fill = "started signals only")


```




```{r plot the pulse data merge data per animal per day other options}

head(VF1_2_3_4buff_cue_animalID)

VF1_2_3_4buff_cue_animalID_by_cue_animal_date <- group_by(VF1_2_3_4buff_cue_animalID, date, animal_ID, audio_pulse_started) %>% 
    summarise(count = n()) 
head(VF1_2_3_4buff_cue_animalID_by_cue_animal_date)

#can I change the date to a factor and then create a box plot?
VF1_2_3_4buff_cue_animalID_by_cue_animal_date$date_factor <- factor(VF1_2_3_4buff_cue_animalID_by_cue_animal_date$date)

VF1_2_3_4buff_cue_animalID_by_cue_animal_date_pulse <- filter(VF1_2_3_4buff_cue_animalID_by_cue_animal_date, audio_pulse_started == "Pulse") 

with(VF1_2_3_4buff_cue_animalID_by_cue_animal_date_pulse, table(date_factor, animal_ID))

### Pulse 

  ggplot(VF1_2_3_4buff_cue_animalID_by_cue_animal_date_pulse, aes(x = date_factor, y = count))+
  geom_boxplot(alpha = 0.2)+
  geom_point()+
  theme_bw()+
  #facet_wrap(. ~ animal_ID)+
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.5) +
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  labs(title= "",
       x= "Date",
       y = "Counts of pulse cues",
       fill = "started signals only")


```


```{r plot the audio data merge data explore data per day}
#explore the data per  day ....


VF1_2_3_4buff_cue_animalID_by_cue_date <- group_by(VF1_2_3_4buff_cue_animalID, date, audio_pulse_started) %>% 
    summarise(count = n()) 
head(VF1_2_3_4buff_cue_animalID_by_cue_date)

#can I change the date to a factor and then create a box plot?
VF1_2_3_4buff_cue_animalID_by_cue_date$date_factor <- factor(VF1_2_3_4buff_cue_animalID_by_cue_date$date)

##as bar per animal per day for audio only
VF1_2_3_4buff_cue_animalID_by_cue_date_audio <- filter(VF1_2_3_4buff_cue_animalID_by_cue_date, audio_pulse_started == "Audio") 

##as bar per animal per day for audio only
ggplot(VF1_2_3_4buff_cue_animalID_by_cue_date_audio, aes(x = date_factor, y = count))+
  geom_col()+
  theme_bw()+
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.5) +
  #geom_text(aes(label = count), vjust = -1.0, hjust = 0.5)+
    theme_classic()+
    labs(x= "Dates",
         y = "counts",
         title = "Counts of aduio cues per day",
         subtitle = "",
         caption = "Started data only. VF 4 buffer data only")+
    theme(axis.text.x=element_text(angle=45,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous( limits=c(0, 400))
##as bar per animal per day for audio only
VF1_2_3_4buff_cue_animalID_by_cue_date_audio <- filter(VF1_2_3_4buff_cue_animalID_by_cue_date, audio_pulse_started == "Audio") 

##as bar per animal per day for pulse only
VF1_2_3_4buff_cue_animalID_by_cue_date_pulse <- filter(VF1_2_3_4buff_cue_animalID_by_cue_date, audio_pulse_started == "Pulse") 
##as bar per animal per day for pulse only
ggplot(VF1_2_3_4buff_cue_animalID_by_cue_date_pulse, aes(x = date_factor, y = count))+
  geom_col()+
  theme_bw()+
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.5) +
  #geom_text(aes(label = count), vjust = -1.0, hjust = 0.5)+
    theme_classic()+
    labs(x= "Dates",
         y = "counts",
         title = "Counts of pulse cues per day",
         subtitle = "",
         caption = "Started data only. VF 4 buffer data only")+
    theme(axis.text.x=element_text(angle=45,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0))+
    scale_y_continuous( limits=c(0, 100))





##as bar per animal per day for both only
filter(VF1_2_3_4buff_cue_animalID_by_cue_date, audio_pulse_started != "NA") %>% 
ggplot( aes(x = date_factor, y = count, fill = audio_pulse_started ))+
  geom_col()+
  theme_bw()+
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.5) +
  #geom_text(aes(label = count), vjust = -1.0, hjust = 0.5)+
    theme_classic()+
    labs(x= "Dates",
         y = "counts",
         title = "Counts of aduio and pulse cues per day",
         subtitle = "",
         caption = "Started data only. VF 4 buffer data only")+
    theme(axis.text.x=element_text(angle=45,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0),
          legend.title=element_blank())+
    scale_y_continuous( limits=c(0, 500))


```



Now is we need to create a ratio of pulse to cue data.
We want a new column that has the number of cues not followed by a pulse.

could do cues - pulse for each day for each animal
or could do a ratio pulse/ cues for each day per animal.

```{r plot the audio data merge data explore data per day}

VF1_2_3_4buff_cue_animalID_by_cue_date <-st_set_geometry(VF1_2_3_4buff_cue_animalID_by_cue_date, NULL)
#reshape the data to get audio and pulse into clms
head(VF1_2_3_4buff_cue_animalID_by_cue_date)
VF1_2_3_4buff_cue_animalID_by_cue_date_temp <- filter(VF1_2_3_4buff_cue_animalID_by_cue_date, audio_pulse_started != "NA") %>% spread(audio_pulse_started, count) 
#if we have NA value replace with 0
VF1_2_3_4buff_cue_animalID_by_cue_date_temp$Pulse[is.na(VF1_2_3_4buff_cue_animalID_by_cue_date_temp$Pulse)] = 0

#head(VF1_2_3_4buff_cue_animalID_by_cue_date_temp)

VF1_2_3_4buff_cue_animalID_by_cue_date_temp <- mutate(VF1_2_3_4buff_cue_animalID_by_cue_date_temp,
                                                      pulse_audio_ratio = Pulse / Audio,
                                                      audio_sub_pulse = Audio - Pulse)
#head(VF1_2_3_4buff_cue_animalID_by_cue_date_temp)
#graph it
##as bar per animal per day for both only
 
ggplot(VF1_2_3_4buff_cue_animalID_by_cue_date_temp,  aes(x = date_factor, y = pulse_audio_ratio))+
  geom_col()+
  theme_bw()+
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.5) +
  #geom_text(aes(label = count), vjust = -1.0, hjust = 0.5)+
    theme_classic()+
    labs(x= "Dates",
         y = "ratio",
         title = "Ratio of pulse to aduio cues per day",
         subtitle = "",
         caption = "Started data only. VF 4 buffer data only")+
    theme(axis.text.x=element_text(angle=45,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0),
          legend.title=element_blank())

ggplot(VF1_2_3_4buff_cue_animalID_by_cue_date_temp,  aes(x = date_factor, y = audio_sub_pulse))+
  geom_col()+
  theme_bw()+
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.5) +
  #geom_text(aes(label = count), vjust = -1.0, hjust = 0.5)+
    theme_classic()+
    labs(x= "Dates",
         y = "counts",
         title = "Cue data expressed as; Audio - Pulse per day",
         subtitle = "",
         caption = "Started data only. VF 4 buffer data only")+
    theme(axis.text.x=element_text(angle=45,hjust=1),
          plot.caption = element_text(size = 8, hjust = 0),
          legend.title=element_blank())
```




#Map out the exclusion data.
I have created a new varaible which is the when the animal is in the exclusion zone (ie in non grazing area)

```{r bring in the exclusion data}



VF1_incur_event <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF1_incur_events.csv")
#head(VF1_incur_event)
VF1_incur_event$date <- as_date(VF1_incur_event$date)
VF1_incur_event$time <- as_datetime(VF1_incur_event$time, tz="GMT")
VF1_incur_event <- mutate(VF1_incur_event,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
sp_VF1_incur_event <- st_as_sf(VF1_incur_event, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)
#check
#ggplot() +
#geom_sf(data = eden_valley, color = "black", fill = NA) +
#  geom_sf(data = st_geometry(sp_VF1_InclusionBord_animalID))

```

Summaries the data based on animal and day

```{r summaries exclusion data}

event_sum_VF1 <- filter(sp_VF1_incur_event, event_number != "NA") %>% 
  group_by( date, animal_ID, event_number) %>% 
  summarise(max_dist = max(distance_VF ), 
            mean_dis = mean(distance_VF ),
            max_time = max(as_datetime(time, tz="GMT")), 
            min_time = min(as_datetime(time, tz="GMT")),
            period_time = round((time_in_exlusion_zone = max_time - min_time), digits = 1))


            
print(event_sum_VF1)
```
Plot the incursion data

```{r import data for incur events}
########################################################################################################################
##############################               VF 1                      #################################################
########################################################################################################################
VF1_incur_event <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF1_incur_events.csv")
#head(VF1_incur_event)
VF1_incur_event$date <- as_date(VF1_incur_event$date)
VF1_incur_event$time <- as_datetime(VF1_incur_event$time, tz="GMT")
VF1_incur_event <- mutate(VF1_incur_event,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
sp_VF1_incur_event <- st_as_sf(VF1_incur_event, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)

########################################################################################################################
##############################               VF 2                      #################################################
########################################################################################################################
VF2_incur_event <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF2_incur_events.csv")
head(VF2_incur_event)
VF2_incur_event$date <- as_date(VF2_incur_event$date)
VF2_incur_event$time <- as_datetime(VF2_incur_event$time, tz="GMT")
VF2_incur_event <- mutate(VF2_incur_event,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
sp_VF2_incur_event <- st_as_sf(VF2_incur_event, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)

########################################################################################################################
##############################               VF 3                      #################################################
########################################################################################################################

VF3_incur_event <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF3_incur_events.csv")
#head(VF3_incur_event)
VF3_incur_event$date <- as_date(VF3_incur_event$date)
VF3_incur_event$time <- as_datetime(VF3_incur_event$time, tz="GMT")
VF3_incur_event <- mutate(VF3_incur_event,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
sp_VF3_incur_event <- st_as_sf(VF3_incur_event, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)

########################################################################################################################
##############################               VF 4                      #################################################
########################################################################################################################

VF4_incur_event <- read.csv(
  "//pearceyhome.csiro.au/HOME_INTEL/ouz001/VF_cattle/catlle_pearcey_recal_dist/Re_cal/VF4_incur_events.csv")
#head(VF4_incur_event)
VF4_incur_event$date <- as_date(VF4_incur_event$date)
VF4_incur_event$time <- as_datetime(VF4_incur_event$time, tz="GMT")
VF4_incur_event <- mutate(VF4_incur_event,
                                     hms = hms::as.hms(time, tz="GMT"))
#assign  coords for each of the VF dataframes
sp_VF4_incur_event <- st_as_sf(VF4_incur_event, 
                                          coords = c("X", "Y"), 
                                          crs = the_crs)

########################################################################################################################
##############################               merge VF1,2,3 4                      #################################################
########################################################################################################################

sp_VF1_2_3_4_incur_event <- rbind(sp_VF1_incur_event,
                                  sp_VF2_incur_event,
                                  sp_VF3_incur_event,
                                  sp_VF4_incur_event)

```

```{r inspect the exclusion data and manipulate it}


head(sp_VF1_2_3_4_incur_event)
#can I change the date to a factor and then create a box plot?
sp_VF1_2_3_4_incur_event$date_factor <- factor(sp_VF1_2_3_4_incur_event$date)
with(sp_VF1_2_3_4_incur_event, table(date_factor, event_number))

#event_sum <- filter(sp_VF1_2_3_4_incur_event, event_number != "NA") %>% 
  event_sum1 <-group_by(sp_VF1_2_3_4_incur_event, date, animal_ID, event_number) %>% 
  summarise(max_dist = max(distance_VF ), 
            mean_dis = mean(distance_VF ),
            max_time = max(as_datetime(time, tz="GMT")), 
            min_time = min(as_datetime(time, tz="GMT")),
            period_time = round((time_in_exlusion_zone = max_time - min_time), digits = 1))
#can I change the date to a factor and then create a box plot?
event_sum1$date_factor <- factor(event_sum1$date)
#drop the geometry clm
event_sum1 <-st_set_geometry(event_sum1, NULL)
 
with(event_sum1, table(date_factor, animal_ID))
head(event_sum1)
#replace the NA event number with NA for the other cals
event_sum2 <- mutate(event_sum1,
                       max_dist = case_when(
                                  event_number != "NA" ~ max_dist), 
                       mean_dis = case_when(
                                  event_number != "NA" ~ mean_dis),
                       max_time = case_when(
                                  event_number != "NA" ~ max_time),
                       min_time = case_when(
                                  event_number != "NA" ~ min_time),
                       period_time = case_when(
                                  event_number != "NA" ~ period_time))

#if I have an NA value replace it with 0
event_sum2$max_dist[is.na(event_sum2$max_dist)] <- 0
event_sum2$mean_dis[is.na(event_sum2$mean_dis)] <- 0
event_sum2$max_time[is.na(event_sum2$max_time)] <- 0 #didnt work
event_sum2$min_time[is.na(event_sum2$min_time)] <- 0 #didnt work
event_sum2$period_time[is.na(event_sum2$period_time)] <- 0

 

```


```{r plot the exclusion data max distance }

#max distance
 ggplot(event_sum2, aes(x = date_factor, y = max_dist))+
  #geom_point()+
  geom_boxplot()+
  #geom_boxplot(outlier.shape=NA)+
  theme_bw()+
  #facet_wrap(. ~ animal_ID)+
  #geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.5) +
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  #,legend.position = "none")+
  labs(title= "",
       x= "date",
       y = "Max distance")

hist(event_sum2$max_dist)

#max distance for all animals 
 ggplot(event_sum2, aes(max_dist))+
   geom_histogram(binwidth = 2, bins = 20)+
    theme_bw()+
     labs(title= "",
       x= "Max distance from VF (m)",
       y = "nunber of events",
       caption = "events occur when animal enters the non grazing zone")

 #max distance for per animals 
 ggplot(event_sum2, aes(max_dist))+
   geom_histogram(binwidth = 2, bins = 20)+
    theme_bw()+
   facet_wrap(.~ animal_ID)+
   labs(title= "",
       x= "Max distance from VF (m)",
       y = "number of events",
       caption = "events occur when animal enters the non grazing zone")

```



mean_dis 

```{r exl mean_dis}
#mean distance
 ggplot(event_sum2, aes(x = date_factor, y = mean_dis))+
  #geom_point()+
  geom_boxplot()+
  #geom_boxplot(outlier.shape=NA)+
  theme_bw()+
  #facet_wrap(. ~ animal_ID)+
  #geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.5) +
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  #,legend.position = "none")+
  labs(title= "",
       x= "date",
       y = "Mean distance")


```



period_time 

```{r exl period of time}


#period_time seconds
 ggplot(event_sum2, aes(x = date_factor, y = period_time))+
  #geom_point()+
  geom_boxplot()+
  #geom_boxplot(outlier.shape=NA)+
  theme_bw()+
  #facet_wrap(. ~ animal_ID)+
  #geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.5) +
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  #,legend.position = "none")+
  labs(title= "",
       x= "date",
       y = "time period seconds")
```


```{r number of events}
str(sp_VF1_2_3_4_incur_event)
VF1_2_3_4_incur_event <-st_set_geometry(sp_VF1_2_3_4_incur_event, NULL)
str(VF1_2_3_4_incur_event)

VF1_2_3_4_incur_event$event_number <- as.double(VF1_2_3_4_incur_event$event_number)
table(VF1_2_3_4_incur_event$event_number)
max(VF1_2_3_4_incur_event$event_number, na.rm=TRUE) 

 event_max <-group_by(VF1_2_3_4_incur_event, date, animal_ID) %>% 
  summarise(max_event = max(event_number,  na.rm=TRUE))
str(event_max)


event_max$date_factor <- factor(event_max$date)



#number of events
 ggplot(event_max, aes(x = date_factor, y = max_event))+
  #geom_point()+
  geom_boxplot()+
  #geom_boxplot(outlier.shape=NA)+
  theme_bw()+
  facet_wrap(. ~ animal_ID)+
  #geom_vline(data=VF_dates, mapping=aes(xintercept=date), color="blue", alpha = 0.5) +
  geom_vline(xintercept= c(1,4,9,15), colour= "blue", alpha = 0.2) +
  theme(axis.text.x=element_text(angle=90,hjust=1))+
  #,legend.position = "none")+
  labs(title= "",
       x= "date",
       y = "max event")
```



